# Go 内存限制设置工具

此模块用于演示如何在 Go 程序中设置和管理内存使用限制，从而避免应用程序消耗过多系统资源，提高系统稳定性。

## 功能特点

- 演示如何设置 Go 程序的最大内存使用量
- 提供多种内存限制方法的实现和比较
- 监控内存使用情况并进行自适应调整
- 针对容器环境的内存限制方法
- 提供性能测试工具，评估内存限制对性能的影响

## 实现方法

Go 程序中设置内存限制主要有以下几种方法：

### 1. GOGC 环境变量

通过设置 GOGC 环境变量或使用 `debug.SetGCPercent()` 函数调整垃圾回收频率：

```go
import "runtime/debug"

// 设置 GOGC 值，较小的值会导致更频繁的 GC
debug.SetGCPercent(50) // 默认值是 100
```

### 2. 设置内存上限（软限制）

通过 `debug.SetMemoryLimit()` 函数设置内存软上限（Go 1.19+）：

```go
import "runtime/debug"

// 设置内存软上限为 1GB
debug.SetMemoryLimit(1 * 1024 * 1024 * 1024)
```

### 3. 手动触发 GC

在适当时机手动触发垃圾回收：

```go
import "runtime"

// 在处理完大量临时对象后手动触发 GC
runtime.GC()
```

### 4. 容器环境内存限制

针对容器环境（如 Docker、Kubernetes）的内存感知和限制：

```go
// 检测容器环境的内存限制并自适应调整
// 在容器中 /sys/fs/cgroup/memory/memory.limit_in_bytes 包含内存限制信息
```

## 使用示例

本模块将包含以下示例：

1. 基础内存限制设置
2. 自适应内存管理
3. 在高负载场景下的内存控制
4. 容器环境中的内存限制

## 最佳实践

1. **根据应用特性选择合适的限制方式**：CPU 密集型、内存密集型、IO 密集型应用需要不同的配置
2. **监控内存使用情况**：实现内存使用监控，及时发现潜在问题
3. **优先优化代码**：在设置内存限制前，先优化代码减少不必要的内存分配
4. **渐进式调整**：根据实际运行情况逐步调整内存限制参数
5. **考虑业务峰值**：设置限制时留有足够余量应对业务峰值

## 性能影响

内存限制会对应用性能产生以下影响：

- 过于严格的限制可能导致 GC 过于频繁，增加 CPU 开销
- 适当的限制可以改善内存局部性，提高缓存命中率
- 对于微服务架构，合理的内存限制可以提高整体资源利用率

## 相关资源

- [Go 内存管理官方文档](https://golang.org/doc/gc-guide)
- [深入理解 Go 内存模型](https://golang.org/ref/mem)
- [Go 1.19 SetMemoryLimit 提案](https://github.com/golang/go/issues/48409) 